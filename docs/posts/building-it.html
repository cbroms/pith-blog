<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/global.css"/><meta name="description" content="Much of the focus of the Pith blog has been about why we&#x27;re designing the system and what we&#x27;re considering while doing so. We&#x27;ve yet to discuss much about how we&#x27;re building Pith, specifically the technologies we&#x27;re using and architecture of the system."/><title>How We&#x27;re Building Pith: Architecture - Pith Blog</title><meta name="next-head-count" content="5"/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-f094e29a130fd0913879.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50e5377bb69f97dcef0b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.e652919804cf5c304a59.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.286c5ad94e4334e87283.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-098d7f699e598de6efba.js" as="script"/><link rel="preload" href="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.c834c71737838cc6651d.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-c363fd144f9206341c0a.js" as="script"/></head><body><div id="__next"><div><div><nav><div id="logo">Pith <span class="blog">Blog</span></div></nav><div class="post-wrapper"><h2 class="post-title large">How We&#x27;re Building Pith: Architecture</h2><time class="post-date" dateTime="2020-09-08">September 8, 2020</time><div class="post-author">Christian Broms &amp; Sydney Zheng</div><div class="post-content"><p>Much of the focus of the Pith blog has been about <em>why</em> we're designing the system and what we're considering while doing so. We've yet to discuss much about <em>how</em> we're building Pith, specifically the technologies we're using and architecture of the system. This post will outline our current approach and rationale.</p>
<h2>The system architecture</h2>
<p>At the most basic level, Pith has two components: a web-based client interface and a server that handles coordinating multiple clients.</p>
<h3>Client</h3>
<p><em>Find the <a href="https://github.com/rainflame/pith-client">client repository on GitHub</a>.</em></p>
<p>We've opted for having the client handle the UI display logic as a standalone <a href="https://reactjs.org/">React</a> / <a href="https://redux.js.org/">Redux</a> project as opposed to server-rendered pages (such as with <a href="https://nextjs.org/">Next.js</a> or <a href="https://www.djangoproject.com/">Django</a>) because we want the server to be generalizable to different client implementations. We see the UI as a flexible and extensible component that sits on top of the core Pith structure and could take many different forms. The web app that we're designing could be extended, remixed, or completely replaced and Pith's core functionality would remain unchanged.</p>
<h3>Communication</h3>
<p>Given Pith is a place for realtime discussion, we needed to build the system a bit like <a href="https://en.wikipedia.org/wiki/Internet_Relay_Chat">IRC</a> with updates automatically pushed to the clients by the server. For websites, this functionality can be implemented using <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API">websockets</a>. We're using the <a href="https://socket.io/">socket.io</a> library because it's easy to use and provides all the functionality we need with its <a href="https://socket.io/docs/rooms/">rooms</a> and <a href="https://socket.io/docs/namespaces/">namespaces</a>.</p>
<h3>Server</h3>
<p><em>Find the <a href="https://github.com/rainflame/pith-api">server repository on GitHub</a>.</em></p>
<p>Rather than use the official Node.js server library for <a href="http://socket.io">socket.io</a>, we have opted to use the community built and maintained <a href="https://python-socketio.readthedocs.io/en/latest/">python-socketio</a> library for two main reasons. First, we're more comfortable with Python as a language, and second, when it comes to implementing the network, reliable and well documented packages like <a href="https://www.nltk.org/">nltk</a>, <a href="https://networkx.github.io/">networkx</a>, and <a href="https://graph-tool.skewed.de/">graph-tool</a> will make development simpler than finding javascript equivalents.</p>
<p>The server is composed of a number of smaller services:</p>
<ul>
<li><code>app</code>: the socketio interface that's used by <a href="https://github.com/rainflame/pith-client">the React client</a>.</li>
<li><code>worker</code>: a worker script using the <a href="https://github.com/samuelcolvin/arq">arq task queue</a> for executing assorted long-term tasks such as archiving discussions when they're complete.</li>
<li><code>redis</code>: a Redis database used by the task queue (<code>worker</code>) and as a message queue by socketio (<code>app</code>).</li>
<li><code>mongo</code>: the MongoDB database used to store the discussion content.</li>
</ul>
<p>We use docker and docker compose for orchestrating building and running each of these services in containers. You can read more about this process in <a href="https://github.com/rainflame/pith-api/blob/master/README.md">the project's readme file</a>.</p>
<h3>Managers</h3>
<p>When it comes to functionality, the <code>app</code> specifies the <a href="https://pith-api.readthedocs.io/en/latest/app.html">API</a> that's used by the client. However, the functions within <code>app</code> only handle the parsing and validation of requests and the proper return or emit of the response. The actual logic of the function is encapsulated in a managing-function called between request handling and response handling. These managing functions reside in manager classes. Currently, we have a manager for any logic surrounding the discussion abstraction. We are also planning on making a manager for logic surrounding the board abstraction and one for the user abstraction.</p>
<h2>Decentralization</h2>
<p>The architecture we've outlined so far is fairly familiar to many online services. However, it's <em>centralized,</em> that is, based on a model in which one organization controls the server(s) responsible for driving the web app. The alternative is a more decentralized approach, perhaps using technology such as WebRTC to allow individual clients to act as their own servers so each individual is responsible for storing and serving their data. However, <a href="https://www.inkandswitch.com/local-first.html#thin-client">a persistent problem</a> with this model is that a user can clear their cookies and data at any time, destroying their contributions to a discussion or board if they are the sole owner of their data. The common response to this issue has been to push the layer of decentralization out to the <em>server.</em> This is the <a href="https://en.wikipedia.org/wiki/Fediverse">fediverse</a>, a space in which servers operating independently from one another communicate over a common protocol to create an emergent network. <a href="https://joinmastodon.org/">Mastodon</a> is a Twitter-like social service that runs on a network of independently owned and operated servers. <a href="https://matrix.org/docs/guides/introduction">Matrix</a> provides the framework for developing chat-like applications using this same decentralized model.</p>
<p>While we don't imagine Pith to take the model of the fediverse (as in independent servers that communicate with each other) we do see decentralization as a crucial component to the project. We'd like to give anyone the freedom to host their own data and create their own instance of a Pith server, for free. The code for the project will always remain open-source with an extremely permissive license (Apache 2.0). Of course, Pith's value isn't based on every user spinning up their own cloud-based virtual machine and running the code. Most will likely engage with Pith through an entity that sets up a server on their behalf, a service that will have to come at a cost. Even so, the separation of Pith's services creates the opportunity for users to provide alternative data storage locations (perhaps with a managed instance of MongoDB with <a href="https://www.mongodb.com/cloud/atlas">MongoDB Atlas</a>) in order to further limit which entities have access to their data.</p>
<p>With this model, we create an ecosystem of Pith servers all running with variable levels of user control:</p>
<ol>
<li>Individuals with full control over their data <em>and</em> server through self hosting both the database and server instances locally or in the cloud.</li>
<li>Individuals with control over their database in the cloud or locally and provided a connection string to the hosting service (the hosting service has no access to the database outside the server software that requires it to run).</li>
<li>Individuals who rely on the hosting service to create a database and server for their Pith instance.</li>
</ol>
<p>Moving down the list moves control of data/server from individual → corporate entity, in addition to monetary cost from free → more expensive. Of course, the opposite is true for time investment in starting the Pith service, here the list goes from quite large → very small. One other trade-off that's common with this model is that technology proficiency would move from highly advanced (infrastructure management ability) → minimal (web browsing ability). We'd like to avoid this particular trade off by ensuring Pith's deployment steps are exceptionally well documented and clear so that a large number of people <em>could</em> follow them, regardless of if they would <em>want</em> to follow them (the time trade off will always be a pertinent one).</p>
</div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"building-it","contentHtml":"\u003cp\u003eMuch of the focus of the Pith blog has been about \u003cem\u003ewhy\u003c/em\u003e we're designing the system and what we're considering while doing so. We've yet to discuss much about \u003cem\u003ehow\u003c/em\u003e we're building Pith, specifically the technologies we're using and architecture of the system. This post will outline our current approach and rationale.\u003c/p\u003e\n\u003ch2\u003eThe system architecture\u003c/h2\u003e\n\u003cp\u003eAt the most basic level, Pith has two components: a web-based client interface and a server that handles coordinating multiple clients.\u003c/p\u003e\n\u003ch3\u003eClient\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003eFind the \u003ca href=\"https://github.com/rainflame/pith-client\"\u003eclient repository on GitHub\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eWe've opted for having the client handle the UI display logic as a standalone \u003ca href=\"https://reactjs.org/\"\u003eReact\u003c/a\u003e / \u003ca href=\"https://redux.js.org/\"\u003eRedux\u003c/a\u003e project as opposed to server-rendered pages (such as with \u003ca href=\"https://nextjs.org/\"\u003eNext.js\u003c/a\u003e or \u003ca href=\"https://www.djangoproject.com/\"\u003eDjango\u003c/a\u003e) because we want the server to be generalizable to different client implementations. We see the UI as a flexible and extensible component that sits on top of the core Pith structure and could take many different forms. The web app that we're designing could be extended, remixed, or completely replaced and Pith's core functionality would remain unchanged.\u003c/p\u003e\n\u003ch3\u003eCommunication\u003c/h3\u003e\n\u003cp\u003eGiven Pith is a place for realtime discussion, we needed to build the system a bit like \u003ca href=\"https://en.wikipedia.org/wiki/Internet_Relay_Chat\"\u003eIRC\u003c/a\u003e with updates automatically pushed to the clients by the server. For websites, this functionality can be implemented using \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API\"\u003ewebsockets\u003c/a\u003e. We're using the \u003ca href=\"https://socket.io/\"\u003esocket.io\u003c/a\u003e library because it's easy to use and provides all the functionality we need with its \u003ca href=\"https://socket.io/docs/rooms/\"\u003erooms\u003c/a\u003e and \u003ca href=\"https://socket.io/docs/namespaces/\"\u003enamespaces\u003c/a\u003e.\u003c/p\u003e\n\u003ch3\u003eServer\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003eFind the \u003ca href=\"https://github.com/rainflame/pith-api\"\u003eserver repository on GitHub\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eRather than use the official Node.js server library for \u003ca href=\"http://socket.io\"\u003esocket.io\u003c/a\u003e, we have opted to use the community built and maintained \u003ca href=\"https://python-socketio.readthedocs.io/en/latest/\"\u003epython-socketio\u003c/a\u003e library for two main reasons. First, we're more comfortable with Python as a language, and second, when it comes to implementing the network, reliable and well documented packages like \u003ca href=\"https://www.nltk.org/\"\u003enltk\u003c/a\u003e, \u003ca href=\"https://networkx.github.io/\"\u003enetworkx\u003c/a\u003e, and \u003ca href=\"https://graph-tool.skewed.de/\"\u003egraph-tool\u003c/a\u003e will make development simpler than finding javascript equivalents.\u003c/p\u003e\n\u003cp\u003eThe server is composed of a number of smaller services:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapp\u003c/code\u003e: the socketio interface that's used by \u003ca href=\"https://github.com/rainflame/pith-client\"\u003ethe React client\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eworker\u003c/code\u003e: a worker script using the \u003ca href=\"https://github.com/samuelcolvin/arq\"\u003earq task queue\u003c/a\u003e for executing assorted long-term tasks such as archiving discussions when they're complete.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eredis\u003c/code\u003e: a Redis database used by the task queue (\u003ccode\u003eworker\u003c/code\u003e) and as a message queue by socketio (\u003ccode\u003eapp\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emongo\u003c/code\u003e: the MongoDB database used to store the discussion content.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWe use docker and docker compose for orchestrating building and running each of these services in containers. You can read more about this process in \u003ca href=\"https://github.com/rainflame/pith-api/blob/master/README.md\"\u003ethe project's readme file\u003c/a\u003e.\u003c/p\u003e\n\u003ch3\u003eManagers\u003c/h3\u003e\n\u003cp\u003eWhen it comes to functionality, the \u003ccode\u003eapp\u003c/code\u003e specifies the \u003ca href=\"https://pith-api.readthedocs.io/en/latest/app.html\"\u003eAPI\u003c/a\u003e that's used by the client. However, the functions within \u003ccode\u003eapp\u003c/code\u003e only handle the parsing and validation of requests and the proper return or emit of the response. The actual logic of the function is encapsulated in a managing-function called between request handling and response handling. These managing functions reside in manager classes. Currently, we have a manager for any logic surrounding the discussion abstraction. We are also planning on making a manager for logic surrounding the board abstraction and one for the user abstraction.\u003c/p\u003e\n\u003ch2\u003eDecentralization\u003c/h2\u003e\n\u003cp\u003eThe architecture we've outlined so far is fairly familiar to many online services. However, it's \u003cem\u003ecentralized,\u003c/em\u003e that is, based on a model in which one organization controls the server(s) responsible for driving the web app. The alternative is a more decentralized approach, perhaps using technology such as WebRTC to allow individual clients to act as their own servers so each individual is responsible for storing and serving their data. However, \u003ca href=\"https://www.inkandswitch.com/local-first.html#thin-client\"\u003ea persistent problem\u003c/a\u003e with this model is that a user can clear their cookies and data at any time, destroying their contributions to a discussion or board if they are the sole owner of their data. The common response to this issue has been to push the layer of decentralization out to the \u003cem\u003eserver.\u003c/em\u003e This is the \u003ca href=\"https://en.wikipedia.org/wiki/Fediverse\"\u003efediverse\u003c/a\u003e, a space in which servers operating independently from one another communicate over a common protocol to create an emergent network. \u003ca href=\"https://joinmastodon.org/\"\u003eMastodon\u003c/a\u003e is a Twitter-like social service that runs on a network of independently owned and operated servers. \u003ca href=\"https://matrix.org/docs/guides/introduction\"\u003eMatrix\u003c/a\u003e provides the framework for developing chat-like applications using this same decentralized model.\u003c/p\u003e\n\u003cp\u003eWhile we don't imagine Pith to take the model of the fediverse (as in independent servers that communicate with each other) we do see decentralization as a crucial component to the project. We'd like to give anyone the freedom to host their own data and create their own instance of a Pith server, for free. The code for the project will always remain open-source with an extremely permissive license (Apache 2.0). Of course, Pith's value isn't based on every user spinning up their own cloud-based virtual machine and running the code. Most will likely engage with Pith through an entity that sets up a server on their behalf, a service that will have to come at a cost. Even so, the separation of Pith's services creates the opportunity for users to provide alternative data storage locations (perhaps with a managed instance of MongoDB with \u003ca href=\"https://www.mongodb.com/cloud/atlas\"\u003eMongoDB Atlas\u003c/a\u003e) in order to further limit which entities have access to their data.\u003c/p\u003e\n\u003cp\u003eWith this model, we create an ecosystem of Pith servers all running with variable levels of user control:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eIndividuals with full control over their data \u003cem\u003eand\u003c/em\u003e server through self hosting both the database and server instances locally or in the cloud.\u003c/li\u003e\n\u003cli\u003eIndividuals with control over their database in the cloud or locally and provided a connection string to the hosting service (the hosting service has no access to the database outside the server software that requires it to run).\u003c/li\u003e\n\u003cli\u003eIndividuals who rely on the hosting service to create a database and server for their Pith instance.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eMoving down the list moves control of data/server from individual → corporate entity, in addition to monetary cost from free → more expensive. Of course, the opposite is true for time investment in starting the Pith service, here the list goes from quite large → very small. One other trade-off that's common with this model is that technology proficiency would move from highly advanced (infrastructure management ability) → minimal (web browsing ability). We'd like to avoid this particular trade off by ensuring Pith's deployment steps are exceptionally well documented and clear so that a large number of people \u003cem\u003ecould\u003c/em\u003e follow them, regardless of if they would \u003cem\u003ewant\u003c/em\u003e to follow them (the time trade off will always be a pertinent one).\u003c/p\u003e\n","title":"How We're Building Pith: Architecture","date":"2020-09-08","author":"Christian Broms \u0026 Sydney Zheng","summary":"Much of the focus of the Pith blog has been about why we're designing the system and what we're considering while doing so. We've yet to discuss much about how we're building Pith, specifically the technologies we're using and architecture of the system."}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"building-it"},"buildId":"mTKVAjf-Z2lpr2NnrNw9B","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-86038f8325ecf14c2308.js"></script><script src="/_next/static/chunks/main-f094e29a130fd0913879.js" async=""></script><script src="/_next/static/chunks/webpack-50e5377bb69f97dcef0b.js" async=""></script><script src="/_next/static/chunks/framework.e652919804cf5c304a59.js" async=""></script><script src="/_next/static/chunks/commons.286c5ad94e4334e87283.js" async=""></script><script src="/_next/static/chunks/pages/_app-098d7f699e598de6efba.js" async=""></script><script src="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.c834c71737838cc6651d.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c363fd144f9206341c0a.js" async=""></script><script src="/_next/static/mTKVAjf-Z2lpr2NnrNw9B/_buildManifest.js" async=""></script><script src="/_next/static/mTKVAjf-Z2lpr2NnrNw9B/_ssgManifest.js" async=""></script></body></html>